---
// Import required components and utilities
import Base from '../../layouts/Base.astro';
import "../../styles/guides.css";
import { getAllGuides, getGuideBySlug } from '../../lib/guidesData.js';

// Define the static paths for all guides
export async function getStaticPaths() {
  // Get all guides from our hard-coded JS module
  const guides = getAllGuides();
  
  // Return the params for each guide
  return guides.map(guide => ({
    params: { slug: guide.data.slug }
  }));
}

// Get the current slug from URL params
const { slug } = Astro.params;

// Look up the guide by slug
const guide = getGuideBySlug(slug);

// Handle 404 if guide not found
if (!guide) {
  return Astro.redirect('/404');
}

// SEO metadata
const pageTitle = guide.data.title;
const title = `${pageTitle} â€¢ Vitamin Brand Index`;
const description = guide.data.summary;
const canonical = `https://vitaminbrandindex.com/guides/${guide.data.slug}/`;
---

<Base {title} {description} {canonical}>
  <main class="guides-container">
    <header class="guide-header">
      <h1>{guide.data.title}</h1>
      <p class="lead">{guide.data.summary}</p>
    </header>

    <nav class="guide-navigation">
      <a href="/guides/" class="link">&larr; Back to Guides</a>
    </nav>

    <article class="guide-content">
      <p>This is a placeholder for the guide content. The actual MDX content will be displayed once the content collection parsing issues are resolved.</p>
      
      <h2>Guide Information</h2>
      <ul>
        <li><strong>Title:</strong> {guide.data.title}</li>
        <li><strong>Key:</strong> {guide.data.headingKey}</li>
      </ul>
    </article>
  </main>

  <script type="application/ld+json">
    {JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Article",
      "headline": guide.data.title,
      "description": guide.data.summary,
      "url": canonical,
      "publisher": {
        "@type": "Organization",
        "name": "Vitamin Brand Index",
        "url": "https://vitaminbrandindex.com/"
      }
    })}
  </script>
</Base>
